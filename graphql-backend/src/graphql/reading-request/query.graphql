extend type Query {
  # Get spread configurations (types and pricing)
  spreadConfigs: [SpreadConfig!]!

  # Get a user's reading requests
  myReadingRequests(userId: ID!, status: ReadingRequestStatus): [ReadingRequest!]!

  # Get a single reading request by ID
  readingRequest(id: ID!, userId: ID!): ReadingRequest

  # Get available requests in the request bank (for merchants)
  availableReadingRequests(limit: Int = 20, offset: Int = 0): [ReadingRequest!]!

  # Get requests claimed by a specific reader/merchant
  claimedReadingRequests(readerId: ID!): [ReadingRequest!]!

  # Get fulfilled readings for a user (completed readings they received)
  myCompletedReadings(userId: ID!): [ReadingRequest!]!

  # Get all reviews for a practitioner (from fulfilled readings)
  practitionerReviews(practitionerId: ID!): [ReadingReview!]!
}

# ============================================
# Enums
# ============================================

# Reading category
enum ReadingRequestCategory {
  TAROT
  ASTROLOGY
}

# Spread type enum (includes both tarot and astrology tiers)
enum SpreadType {
  # Tarot spreads
  SINGLE
  THREE_CARD
  FIVE_CARD
  # Astrology tiers
  ASTRO_SNAPSHOT
  ASTRO_FOCUS
  ASTRO_DEEP_DIVE
}

# Astrology focus area
enum AstrologyFocusArea {
  birth_chart
  transit
  compatibility
  solar_return
  single_planet
  life_area
}

# Request status enum
enum ReadingRequestStatus {
  PENDING_PAYMENT  # Created, waiting for payment method to be saved
  AWAITING_CLAIM   # Payment method saved, waiting for reader to claim
  CLAIMED          # Reader has claimed, working on fulfillment
  FULFILLED        # Reading completed, payment captured
  CANCELLED
  EXPIRED
}

# ============================================
# Spread Configuration
# ============================================

# Spread configuration type
type SpreadConfig {
  type: SpreadType!
  category: ReadingRequestCategory!
  label: String!
  cardCount: Int!
  price: Int! # In cents
  description: String!
}

# ============================================
# Tarot Types
# ============================================

# Card in a tarot reading
type ReadingCard {
  name: String!
  reversed: Boolean!
  position: String!
  interpretation: String!
  symbols: [String!] # Auto-extracted symbols from card name
}

# ============================================
# Astrology Types (for reading requests)
# ============================================

# Birth data submitted with astrology request
type ReadingBirthData {
  birthDate: String!
  birthTimePrecision: String!
  birthTime: String
  birthTimeApproximate: String
  birthLocation: ReadingBirthLocation!
}

type ReadingBirthLocation {
  city: String!
  country: String!
  countryCode: String!
  latitude: Float!
  longitude: Float!
  timezone: String!
}

# Astrology-specific request data
type AstrologyRequestData {
  focusArea: AstrologyFocusArea!
  birthData: ReadingBirthData!
  partnerBirthData: ReadingBirthData
  specificPlanet: String
  specificLifeArea: String
}

# An aspect highlighted by the practitioner
type HighlightedAspect {
  planet1: String!
  planet2: String!
  aspect: String!
  interpretation: String!
}

# Astrology-specific fulfillment data
type AstrologyFulfillment {
  interpretation: String!
  highlightedAspects: [HighlightedAspect!]
  chartImageUrl: String
  practitionerRecommendation: String
}

# ============================================
# Stripe & Core Types
# ============================================

# Stripe payment details
type ReadingRequestStripe {
  setupIntentId: String
  setupIntentSecret: String
  paymentMethodId: String
  paymentIntentId: String
  chargeId: String
  connectedAccountId: String
}

# Reading request type
type ReadingRequest {
  id: ID!
  userId: ID!
  userEmail: String
  userName: String

  readingCategory: ReadingRequestCategory!
  spreadType: SpreadType!
  topic: String!
  context: String

  # Astrology-specific request data
  astrologyData: AstrologyRequestData

  # Payment info
  stripe: ReadingRequestStripe
  stripeCustomerId: String

  price: Int!
  platformFee: Int!
  readerPayout: Int!

  requestStatus: ReadingRequestStatus!
  claimedBy: ID
  claimedAt: String
  claimDeadline: String # Shotclock - reader must fulfill by this time

  # Tarot fulfilled reading data
  photoUrl: String
  cards: [ReadingCard!]
  overallMessage: String

  # Astrology fulfilled reading data
  astrologyFulfillment: AstrologyFulfillment

  fulfilledAt: String

  createdAt: String!
  updatedAt: String!
  expiresAt: String

  # User's review of the reading (only present after review submitted)
  review: ReadingReview

  ref: RecordRef!
}
